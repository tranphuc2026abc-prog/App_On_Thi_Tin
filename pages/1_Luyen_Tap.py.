import streamlit as st
import json

st.set_page_config(page_title="Luyá»‡n Táº­p - Ã”n Thi Tin", layout="wide")

# HÃ m Ä‘á»c dá»¯ liá»‡u Ä‘á» thi
def load_data():
    try:
        with open('data.json', 'r', encoding='utf-8') as f:
            return json.load(f)
    except:
        return []

data = load_data()

st.title("ğŸ“– ThÆ° Viá»‡n Äá» Thi Tráº¯c Nghiá»‡m")

if not data:
    st.error("ChÆ°a cÃ³ dá»¯ liá»‡u Ä‘á» thi. Tháº§y Khanh vui lÃ²ng kiá»ƒm tra file data.json nhÃ©!")
else:
    # 1. Chá»n Ä‘á» thi
    danh_sach_ten_de = [d['ten'] for d in data]
    chon_de = st.selectbox("Chá»n Ä‘á» em muá»‘n luyá»‡n táº­p:", danh_sach_ten_de)
    
    # Láº¥y dá»¯ liá»‡u cá»§a Ä‘á» Ä‘Ã£ chá»n
    de_hien_tai = next(d for d in data if d['ten'] == chon_de)
    
    st.divider()
    st.subheader(f"ğŸ“ {de_hien_tai['ten']}")

    # 2. Hiá»ƒn thá»‹ danh sÃ¡ch cÃ¢u há»i (Pháº§n I)
    diem = 0
    with st.form("form_lam_bai"):
        for i, cau_hoi in enumerate(de_hien_tai['phan_1']):
            st.write(f"**CÃ¢u {cau_hoi['cau']}: {cau_hoi['noi_dung']}**")
            answer = st.radio(f"Chá»n Ä‘Ã¡p Ã¡n cho cÃ¢u {cau_hoi['cau']}:", 
                              cau_hoi['lua_chon'], 
                              key=f"q_{i}",
                              index=None)
            
            # Kiá»ƒm tra Ä‘Ã¡p Ã¡n (Láº¥y chá»¯ cÃ¡i Ä‘áº§u A, B, C, D)
            if answer and answer.startswith(cau_hoi['dap_an']):
                diem += 1
        
        # NÃºt ná»™p bÃ i trong Form
        submitted = st.form_submit_state = st.form_submit_button("Ná»™p bÃ i & Cháº¥m Ä‘iá»ƒm")
        
        if submitted:
            st.balloons()
            st.success(f"Káº¿t quáº£ cá»§a em: {diem}/{len(de_hien_tai['phan_1'])} cÃ¢u Ä‘Ãºng.")
            
            # TÃ­nh pháº§n trÄƒm tiáº¿n Ä‘á»™ Ä‘á»ƒ cáº­p nháº­t vÃ o session_state (náº¿u cáº§n)
            st.session_state.progress = int((diem / len(de_hien_tai['phan_1'])) * 100)

# ChÃ¢n trang
st.sidebar.info("Há»‡ thá»‘ng cháº¥m Ä‘iá»ƒm tá»± Ä‘á»™ng theo cáº¥u trÃºc Bá»™ GD&ÄT.")
